{% extends 'base.html.twig' %}

{% block title %}Conversation{% endblock %}

{% block stylesheets %}
<style>
    :root {
        --primary: #004aad;
        --accent:#004aad;
        --text-dark: #343a40;
    }

    #messages {
        border: 1px solid #ccc;
        padding: 10px;
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 20px;
        background-color: #f8f9fa;
    }

    .sent {
        text-align: right;
        background-color: rgba(111, 66, 193, 0.1); /* violet clair */
        color: var(--primary);
        margin: 5px;
        padding: 10px;
        border-radius: 10px;
        max-width: 60%;
        margin-left: auto;
    }

    .received {
        text-align: left;
        background-color: #eee;
        color: var(--text-dark);
        margin: 5px;
        padding: 10px;
        border-radius: 10px;
        max-width: 60%;
    }

    .message-actions {
        font-size: 0.85em;
        margin-top: 5px;
    }

    .message-actions a,
    .message-actions button {
        color: var(--accent);
        background: none;
        border: none;
        cursor: pointer;
        margin-right: 5px;
    }

    .message-actions form {
        display: inline;
    }



    form button:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block body %}
<h2>üí¨ Conversation avec {{ receveur.Prenoms }} {{ receveur.Nom }}</h2>

<div id="messages">
    {% for message in messages %}
        <div class="message {{ message.getRelation().id == app.user.id ? 'sent' : 'received' }}">
            <p>{{ message.getContexte() }}</p>
            <small>{{ message.getDateEnvoi()|date('d/m/Y H:i') }}</small>

            {% if message.getRelation().id == app.user.id %}
                <div class="message-actions">
                    <a href="{{ path('message_modifier', {id: message.id}) }}">‚úèÔ∏è Modifier</a>
                    <form action="{{ path('message_supprimer', {id: message.id}) }}" method="POST" onsubmit="return confirm('Supprimer ce message ?')" style="display:inline;">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete-message' ~ message.id) }}">
                        <button type="submit">üóëÔ∏è Supprimer</button>
                    </form>
                </div>
            {% endif %}
        </div>
    {% endfor %}
</div>

<h3>‚úâÔ∏è Envoyer un message</h3>
{{ form_start(form) }}
    {{ form_row(form.contexte) }}
    <button class="btn btn-success">Envoyer</button>
{{ form_end(form) }}
{% endblock %}
